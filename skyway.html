<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://skyway.io/dist/0.3/peer.min.js"></script>
    <script src="https://skyway.io/dist/multiparty.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0-rc.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" id="jquery-ui-css" href="https://code.jquery.com/ui/1.12.0-rc.1/themes/smoothness/jquery-ui.css" type="text/css" media="all" />

<style>
    #streams {
        width: 100%;
    }
    #streams div.ui-resizable{
        border: 1px solid #DDDDDD;
        width: 50%;
    }
    #streams div.head{
        width: 100%;
        height: 25px;
        background-color: #444;
    }
    video {
        max-width: 100%;
        max-height: calc(100% - 25px);
    }
</style>

</head>
<body>

<div id="streams">
</div>

<script>
function insertDiv(node) {
    $("<div>").append("<div class='head'>").append($(node)).resizable().draggable().appendTo("#streams");
}
function start(key) {
    // MultiParty インスタンスを生成
    var multiparty = new MultiParty( {
        "key": key    /* SkyWay keyを指定 */
    });

    multiparty.on("my_ms", function(video) {
        var vNode = MultiParty.util.createVideoNode(video);
        insertDiv(vNode);
    }).on("peer_ms", function(video) {
        console.log("peer_ms", video);
        var vNode = MultiParty.util.createVideoNode(video);
        insertDiv(vNode);
    }).on("ms_close", function(peer_id) {
        console.log("ms_close", peer_id);
        $("#" + peer_id).parent().remove();
    });

    // サーバとpeerに接続
    multiparty.start()
}
$(function () {
    $("#btn_ok").on("click", function(){
        start($("#key").val());
        $("#key, #btn_ok").remove();
    });

});
</script>

<input type="text" id="key" placeholder="ここにKEYを入力">
<input type="button" id="btn_ok" value="OK">
</body>
</html>
